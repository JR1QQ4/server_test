1、渗透测试之信息收集
- 在信息收集中，最主要的就是收集服务器的配置信息和网站的敏感信息，其中包括域名及子域名信息、目标网站系统、CMS指纹、目标网站真实IP、开放的端口等
- 收集域名信息
    - 第一步，获取域名的注册信息，包括DNS服务器信息和注册人的联系信息等，常用方法如下：
        - ①Whois查询
            - 在Kali系统中，可以使用命令`whois www.baidu.com`
            - 在线常用网站有爱站工具网（https://www.aizhan.com/）、站长之家（http://whois.chinaz.com/）、VirusTotal(https://www.virustotal.com/)
        - ②备案信息查询
            - ICP备案查询网：https://beian.miit.gov.cn/#/Integrated/recordQuery
            - 站长工具：http://icp.chinaz.com/
            - 天眼查：https://www.tianyancha.com/
- 收集敏感信息
    - Google搜索常用语法，可以多个一起使用
        - Site —— 制定域名
        - Inurl —— URL中存在关键字的网页
        - Intext —— 网页正文中的关键字
        - Filetype —— 制定文件类型
        - Intitle —— 网页标题中的关键字
        - link —— link:baidu.com即表示返回所有和baidu.com做了链接的URL
        - Info —— 查找指定站点的一些基本信息
        - cache —— 搜索Google你关于某些内容的缓存
- 收集子域名信息
    - 1）子域名检测工具：Layer子域名挖掘机、K8、wydomain、Sublist3r、dnsmaper、subDomainsBrute、Maltego CE等
    - 2）搜索引擎枚举：site:baidu.com
    - 3）第三方聚合应用枚举：使用DNSdumpster、在线DNS侦查和搜索的工具挖掘出指定域潜藏的大量子域
    - 4）证书透明度公开日志枚举：https://crt.sh 和 https://censys.io
- 收集常用端口信息
    - 扫描工具：Nmap、Masscan、ZMap和御剑高速TCP端口扫描工具
    - 常见端口
        - 文件共享服务端口
            - 21/22/69 —— Ftp/Tftp文件传输协议，攻击方向——允许匿名的上传、下载、爆破和嗅探操作
            - 2049 —— Nfs服务，攻击方向——配置不当
            - 139 —— Samba服务，攻击方向——爆破、未授权访问、远程代码执行
            - 389 —— Ldap目录访问协议，攻击方向——注入、允许匿名访问、弱口令
        - 远程连接服务端口
            - 22 —— SSH远程连接，攻击方向——爆破、SSH隧道及内网代理转发、文件传输
            - 23 —— Telnet远程连接，攻击方向——爆破、嗅探、弱口令
            - 3389 —— Rdp远程桌面连接，攻击方向——Shift后门（需要Windows Server2003以下的系统）、爆破
            - 5900 —— VNC，攻击方向——弱口令爆破
            - 5632 —— PyAnywhere服务，攻击方向——抓密码、代码执行
        - Web应用服务端口
            - 80/443/8080 —— 常见的Web服务端口，攻击方向——Web攻击、爆破、对应服务器版本漏洞
            - 7001/7002 —— WebLogic控制台，攻击方向——Java反序列化、弱口令
            - 8080/8089 —— Jboss/Resin/Jetty/Jenkins，攻击反序——反序列化、控制台弱口令
            - 9090 —— WebSphere控制台，攻击方向——Java反序列化、弱口令
            - 4848 —— GlassFish控制台，攻击方向——弱口令
            - 1352 —— Lotus domino邮件服务，攻击方向——弱口令、信息泄露、爆破
            - 10000 —— Webmin-Web控制面板，攻击方向——弱口令
        - 数据库服务端口
            - 3306 —— MySQL，攻击方向——注入、提权、爆破
            - 1433 —— MSSQL，攻击方向——注入、提权、SA弱口令、爆破
            - 1521 —— Oracle，攻击方向——TNS爆破、注入、反弹Shell
            - 5432 —— PostgreSQL，攻击方向——爆破、注入、弱口令
            - 27017/27018 —— MongoDB，攻击方向——爆破、未授权访问
            - 6379 —— Redis，攻击方向——可尝试未授权访问、弱口令爆破
            - 50000 —— SysBase/DB2，攻击方向——爆破、注入
        - 邮件服务端口
            - 25 —— SMTP邮件服务，攻击方向——邮件伪造
            - 110 —— POP3协议，攻击方向——爆破、嗅探
            - 143 —— IMAP协议，攻击方向——爆破
        - 网络常见协议端口
            - 53 ——　DNS —— 允许区域传送、DNS劫持、缓存投毒、欺骗
            - 67/68 —— DHCP —— 劫持、欺骗
            - 161 —— SNMP —— 爆破、收集目标内网信息
        - 特殊服务端口
            - 2181 —— Zookeeper —— 未授权访问
            - 8069 —— Zabbix —— 远程执行、SQL注入
            - 9200/9300 —— Elasticsearch —— 远程执行
            - 11211 —— Memcache ——　未授权访问
            - 512/513/514 —— Linux Rexec —— 匿名访问、文件上传
            - 3690 —— Svn —— Svn泄露、未授权访问
            - 50000 —— SAP Management Console —— 远程执行
- 指纹识别
    - 指的是网站CMS指纹识别、计算机操作系统及Web容器的指纹识别等
    - 应用程序一般在html、css、js等文件中多多少少包含一些特征码，比如WordPress在robots.txt中包含wp-admin
    - CMS（Content Management System）又称整站系统或文章系统，常见的有Dedecms织梦、Discuz、PHPWEB、PHPWind、PHPCMS、帝国、WordPress等
    - 代表工具有御剑Web指纹识别、WhatWeb、WebRobo、椰树、轻量WEB指纹识别等
    - 网站查询CMS指纹识别：BugScaner、云悉指纹、WhatWeb
- 查找真实IP
    - 如果目标服务器不存在CDN，可以直接通过www.ip138.com获取目标的一些IP及域名信息
    - 1）目标服务器存在CDN
        - CDN即内容分发网络，主要解决应传输距离和不同运营商节点造成的网络速度性能低下的问题；就是一组在不同运营商之间的对接节点上的高速缓存服务器，
        把用户经常访问的静态数据资源直接缓存到节点服务器上，当用户再次请求时，会直接分发到在离用户近的节点服务器上响应给用户，当用户有实际数据交互时
        才会从远程Web服务器上响应，这样可以大大提高网站的响应速度及用户体验
        - 如果购买了CDN服务，直接ping目标的域名，得到的并非真正的目标Web服务器
    - 2）判断目标是否使用了CDN
        - ping目标主域，观察域名的解析情况，以此来判断是否使用了CDN
        - 利用在线网站17CE进行全国多地区的ping服务器操作，然后对比每个地区ping出的IP结果，如果IP大多不太一样或者规律性钱，可以尝试查询这些IP的归属地来判断
    - 3）绕过CDN寻找真实IP
        - 内部邮箱源。一般的邮件系统都在内部，没有经过CDN的解析，通过目标网站用户注册或者RSS订阅功能，查看邮件、寻找邮件头中的邮件服务器域名IP，
        ping这个邮件服务器的域名，就可以获得目标的真实IP（注意，必须时目标自己的邮件服务器，第三方或公共邮件服务器是没有用的）
        - 扫描网站测试文件，如phpinfo、test等，从而找到目标的真实IP
        - 分站域名。主站都是挂CDN的，但是分站可能没有挂CDN，可以通过ping二级域名获取分站IP，可能会出现分站和主站不是同一个IP但在同一个C段下面的
        情况，从而判断出目标的真实IP段
        - 国外访问。国内的CDN往往只对国内用户的访问加速，而国外的CDN就不一定了。通过国外在线代理网站App Synthetic Monitor访问，可能会得到
        真实的IP
        - 查询域名的解析记录。通过网站NETCRAFT来观察域名的IP历史记录，也可以大致分析出目标的真实IP段
        - 如果目标网站有自己的App，可以尝试利用Fiddler或BurpSuite抓取App的请求，从里面找到目标的真实IP
        - 绕过CloudFlare CDN查找真实IP。如果网站使用CloudFlare提供的CDN服务，在确定目标网站使用CDN后，可以先尝试通过在线网站Cloud FlareWatch
        对CloudFlare客户网站进行真实IP查询
    - 4）验证获取的IP
        - 最简单的验证方法是直接尝试用IP访问，看看响应的页面是不是和访问域名返回的一样
        - 或者在目标段比较大的情况下，借助类似Masscan的工具批扫描对应IP段中所有开了80、443、8080端口的IP，然后逐个尝试IP访问，观察响应结果是否为目标站点

















